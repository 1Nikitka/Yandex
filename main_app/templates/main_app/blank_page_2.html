{% load static %}
{% load widget_tweaks %}
{% block content %}
<!doctype html>
<html lang="ru" dir="ltr">

    <head>
        <meta charset="utf-8" />
        <title>Demo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Premium Bootstrap 5 Landing Page Template" />
        <meta name="keywords" content="Saas, Software, multi-uses, HTML, Clean, Modern" />
        <meta name="author" content="Shreethemes" />
        <meta name="email" content="support@shreethemes.in" />
        <meta name="website" content="https://shreethemes.in" />
        <meta name="Version" content="v4.9.0" />

     <link rel="shortcut icon" href="{% static 'main_app/images/favicon.ico' %}" />

    <!-- Css -->
    <link href="{% static 'main_app/libs/simplebar/simplebar.min.css' %}" rel="stylesheet">

    <!-- Bootstrap Css -->
    <link href="{% static 'main_app/css/bootstrap.min.css' %}" class="theme-opt" rel="stylesheet" type="text/css" />

    <!-- Icons Css -->
    <link href="{% static 'main_app/libs/@mdi/font/css/materialdesignicons.min.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'main_app/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'main_app/libs/@iconscout/unicons/css/line.css' %}" type="text/css" rel="stylesheet" />
        <link href="{% static 'css/custom.css' %}" rel="stylesheet">


    <!-- Style Css -->
    <link href="{% static 'main_app/css/style.min.css' %}" class="theme-opt" rel="stylesheet" type="text/css" />


    </head>

    <body>
        <!-- Loader -->
        <!-- <div id="preloader">
            <div id="status">
                <div class="spinner">
                    <div class="double-bounce1"></div>
                    <div class="double-bounce2"></div>
                </div>
            </div>
        </div> -->
        <!-- Loader -->

        <div class="page-wrapper toggled">
            <!-- sidebar-wrapper -->
                       <nav id="sidebar" class="sidebar-wrapper sidebar-dark">
                <div class="sidebar-content" data-simplebar style="height: calc(100% - 60px);">
        <div class="sidebar-brand">
            <a href="{% url 'search' %}">
                <img src="{% static 'main_app/images/logo-dark.png' %}" height="24" class="logo-light-mode" alt="">
                <img src="{% static 'main_app/images/logo-light.png' %}" height="24" class="logo-dark-mode" alt="">
                <span class="sidebar-colored">
                    <img src="{% static 'main_app/images/logo-light.png' %}" height="24" alt="">
                </span>
            </a>
        </div>

        <ul class="sidebar-menu">
            <li class="sidebar-dropdown">
               <a href="{% url 'search' %}"><i class="ti ti-home me-2"></i>Запуск программы</a>
            </li>
        </ul>

        <ul class="sidebar-menu">
            <li class="sidebar-dropdown">
                <a href="{% url 'blank_page_2' %}"><i class="ti ti-home me-2"></i>Результат</a>
            </li>
        </ul>

        <ul class="sidebar-menu">
            <li class="sidebar-dropdown">
                <a href="{% url 'blank_page_3' %}"><i class="ti ti-home me-2"></i>Проверка руководителя</a>
            </li>
        </ul>
    </div>

                <!-- Sidebar Footer -->
                <ul class="sidebar-footer list-unstyled mb-0">
                    <li class="list-inline-item mb-0">
                        <a href="https://1.envato.market/landrick" target="_blank" class="btn btn-icon btn-soft-light"><i class="ti ti-shopping-cart"></i></a> <small class="text-muted fw-medium ms-1">Buy Now</small>
                    </li>
                </ul>
                <!-- Sidebar Footer -->
            </nav>
            <!-- sidebar-wrapper  -->

            <!-- Start Page Content -->
            <main class="page-content bg-light">
                <!-- Top Header -->
                <div class="top-header">
                    <div class="header-bar d-flex justify-content-between">
                        <div class="d-flex align-items-center">
                            <a href="gallery-two.html#" class="logo-icon me-3">
                                <img src="assets/images/logo-icon.png" height="30" class="small" alt="">
                                <span class="big">
                                    <img src="assets/images/logo-dark.png" height="24" class="logo-light-mode" alt="">
                                    <img src="assets/images/logo-light.png" height="24" class="logo-dark-mode" alt="">
                                </span>
                            </a>
                            <a id="close-sidebar" class="btn btn-icon btn-soft-light" href="javascript:void(0)">
                                <i class="ti ti-menu-2"></i>
                            </a>
                            <div class="search-bar p-0 d-none d-md-block ms-2">
                                <div id="search" class="menu-search mb-0">
                                    <form role="search" method="get" id="searchform" class="searchform">
                                        <div>
                                            <input type="text" class="form-control border rounded" name="s" id="s" placeholder="Search Keywords...">
                                            <input type="submit" id="searchsubmit" value="Search">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <ul class="list-unstyled mb-0">
                            <li class="list-iline-item mb-0">
                                <a href="javascript:void(0)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                                    <div class="btn btn-icon btn-soft-light"><i class="ti ti-settings"></i></div>
                                </a>
                            </li>

                            <li class="list-inline-item mb-0 ms-1">
                                <div class="dropdown dropdown-primary">
                                    <button type="button" class="btn btn-icon btn-soft-light dropdown-toggle p-0" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ti ti-bell"></i></button>
                                    <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle">
                                        <span class="visually-hidden">New alerts</span>
                                    </span>
                    
                                    <div class="dropdown-menu dd-menu shadow rounded border-0 mt-3 p-0" data-simplebar style="height: 320px; width: 290px;">
                                        <div class="d-flex align-items-center justify-content-between p-3 border-bottom">
                                            <h6 class="mb-0 text-dark">Notifications</h6>
                                            <span class="badge bg-soft-danger rounded-pill">3</span>
                                        </div>
                                        <div class="p-3">
                                            <a href="gallery-two.html#!" class="dropdown-item features feature-primary key-feature p-0">
                                                <div class="d-flex align-items-center">
                                                    <div class="icon text-center rounded-circle me-2">
                                                        <i class="ti ti-shopping-cart"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h6 class="mb-0 text-dark title">Order Complete</h6>
                                                        <small class="text-muted">15 min ago</small>
                                                    </div>
                                                </div>
                                            </a>
                            
                                            <a href="gallery-two.html#!" class="dropdown-item features feature-primary key-feature p-0 mt-3">
                                                <div class="d-flex align-items-center">
                                                    <img src="assets/images/client/04.jpg" class="avatar avatar-md-sm rounded-circle border shadow me-2" alt="">
                                                    <div class="flex-1">
                                                        <h6 class="mb-0 text-dark title"><span class="fw-bold">Message</span> from Luis</h6>
                                                        <small class="text-muted">1 hour ago</small>
                                                    </div>
                                                </div>
                                            </a>
                            
                                            <a href="gallery-two.html#!" class="dropdown-item features feature-primary key-feature p-0 mt-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="icon text-center rounded-circle me-2">
                                                        <i class="ti ti-currency-dollar"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h6 class="mb-0 text-dark title"><span class="fw-bold">One Refund Request</span></h6>
                                                        <small class="text-muted">2 hour ago</small>
                                                    </div>
                                                </div>
                                            </a>

                                            <a href="gallery-two.html#!" class="dropdown-item features feature-primary key-feature p-0 mt-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="icon text-center rounded-circle me-2">
                                                        <i class="ti ti-truck-delivery"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h6 class="mb-0 text-dark title">Deliverd your Order</h6>
                                                        <small class="text-muted">Yesterday</small>
                                                    </div>
                                                </div>
                                            </a>
                            
                                            <a href="gallery-two.html#!" class="dropdown-item features feature-primary key-feature p-0 mt-3">
                                                <div class="d-flex align-items-center">
                                                    <img src="assets/images/client/15.jpg" class="avatar avatar-md-sm rounded-circle border shadow me-2" alt="">
                                                    <div class="flex-1">
                                                        <h6 class="mb-0 text-dark title"><span class="fw-bold">Cally</span> started following you</h6>
                                                        <small class="text-muted">2 days ago</small>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </li>

                            <li class="list-inline-item mb-0 ms-1">
                                <div class="dropdown dropdown-primary">
                                    <button type="button" class="btn btn-soft-light dropdown-toggle p-0" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="assets/images/client/05.jpg" class="avatar avatar-ex-small rounded" alt=""></button>
                                    <div class="dropdown-menu dd-menu dropdown-menu-end shadow border-0 mt-3 py-3" style="min-width: 200px;">
                                        <a class="dropdown-item d-flex align-items-center text-dark pb-3" href="profile.html">
                                            <img src="assets/images/client/05.jpg" class="avatar avatar-md-sm rounded-circle border shadow" alt="">
                                            <div class="flex-1 ms-2">
                                                <span class="d-block">Cristina Julia</span>
                                                <small class="text-muted">UI / UX Designer</small>
                                            </div>
                                        </a>
                                        <a class="dropdown-item text-dark" href="{% url 'logout' %}"><span class="mb-0 d-inline-block me-1"><i class="ti ti-logout"></i></span>Выйти</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
               		
<div class="container-fluid">
    <div class="layout-specing">
        <div class="d-md-flex justify-content-between align-items-center">
            <h5 class="mb-0">Общая выдача</h5>
            <nav aria-label="breadcrumb" class="d-inline-block">
                <ul class="breadcrumb bg-transparent rounded mb-0 p-0">
                    <li class="breadcrumb-item text-capitalize"><a href="#">Главная</a></li>
                    <li class="breadcrumb-item text-capitalize active" aria-current="page">Результаты</li>
                </ul>
            </nav>
        </div>

    {% if status == 'done' %}
<div class="row">
    <div class="col-12 mt-4">
        <div class="table-responsive shadow rounded">
            <table class="table table-center bg-white mb-0">
                <thead>
                    <tr>
                        <th class="border-bottom p-3">Id</th>
                        <th class="border-bottom p-3" style="min-width: 220px;">Город</th>
                        <th class="text-center border-bottom p-3" style="min-width: 200px;">Сайт</th>
                        <th class="text-center border-bottom p-3">Заголовок сайта</th>
                        <th class="text-center border-bottom p-3">Описание</th>
                        <th class="text-center border-bottom p-3" style="min-width: 150px;">Телефон</th>
                        <th class="text-center border-bottom p-3">Email</th>
                        <th class="text-center border-bottom p-3">ИНН</th>
                        <th class="text-end border-bottom p-3" style="min-width: 200px;"></th>
                    </tr>
                </thead>
                <tbody>
                {% for item in page_obj %}
                    <tr id="row-{{ item.id }}">
                        <th class="p-3">{{ item.id }}</th>
                        <td class="p-3">
                            <div class="d-flex align-items-center">
                                <span class="ms-2">{{ item.Sity|default:"-" }}</span>
                            </div>
                        </td>
                        <td class="text-center p-3">
                            {% if item.Link_baza_json %}
                                <a href="{{ item.Link_baza_json }}" target="_blank">{{ item.Link_baza_json }}</a>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td class="text-center p-3">{{ item.Zagolovok_json_sait|default:"–" }}</td>
                        <td class="text-center p-3">{{ item.SnipetL_baza|default:"–"|safe }}</td>
                        <td class="text-center p-3">
                            {{ item.phone|default:"–" }}
                        </td>
                        <td class="text-center p-3">
							<p>{{ item.email_list.0|default:"Не найден" }}</p>

						</td>
                        <td class="text-center p-3">
                            {% if item.TIN == "ИНН не найден на странице." %}
                                <div class="badge bg-soft-danger rounded px-3 py-1">Не найден</div>
                            {% else %}
                                <div class="badge bg-soft-success rounded px-3 py-1">Найден</div>
                            {% endif %}
                        </td>
                        <td class="text-end p-3">
                            <div class="d-flex justify-content-end flex-wrap gap-2">
                                <a href="#" class="btn btn-sm btn-soft-primary" data-bs-toggle="modal" data-bs-target="#modal-{{ forloop.counter }}">Вся информация</a>

								{% csrf_token %}
								<a href="#" class="btn btn-sm btn-success take-item" data-id="{{ item.id }}">Взять в работу</a>


								<a href="#" class="btn btn-sm btn-danger" data-id="{{ item.id }}">Удалить</a>
                            </div>
                        </td>
                    </tr>

                    <!-- Модальное окно -->
                    <div class="modal fade" id="modal-{{ forloop.counter }}" tabindex="-1" aria-labelledby="modalLabel-{{ forloop.counter }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content">
                                <div class="modal-header border-bottom p-3">
                                    <h5 class="modal-title" id="modalLabel-{{ forloop.counter }}">Название компании: {{ item.Zagolovok_json_sait|default:"–" }}</h5>
                                    <button type="button" class="btn btn-icon btn-close" data-bs-dismiss="modal" aria-label="Закрыть">
                                        <i class="uil uil-times fs-4 text-dark"></i>
                                    </button>
                                </div>
                                <div class="modal-body p-3 pt-4">
                                    <div class="row">
                                        <div class="d-flex align-items-center mt-3">
                                            <i data-feather="bookmark" class="fea icon-ex-md text-muted me-3"></i>
                                            <div class="flex-1">
                                                <h6 class="text-primary mb-0">Сайт :</h6>
                                                {% if item.Link_baza_json %}
                                                    <a href="{{ item.Link_baza_json }}" target="_blank" class="text-muted">{{ item.Link_baza_json }}</a>
                                                {% else %}
                                                    <span class="text-muted">–</span>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <div class="d-flex align-items-center mt-3">
                                            <i data-feather="gift" class="fea icon-ex-md text-muted me-3"></i>
                                            <div class="flex-1">
                                                <h6 class="text-primary mb-0">Город :</h6>
                                                <p class="text-muted mb-0">{{ item.Sity|default:"–" }}</p>
                                            </div>
                                        </div>

                                        <div class="d-flex align-items-center mt-3">
                                            <i data-feather="map-pin" class="fea icon-ex-md text-muted me-3"></i>
                                            <div class="flex-1">
                                                <h6 class="text-primary mb-0">ИНН :</h6>
                                                {% if item.TIN == "ИНН не найден на странице." %}
                                                    <span class="text-muted">Не найден</span>
                                                {% else %}
                                                    <span class="text-muted">{{ item.TIN }}</span>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <div class="d-flex align-items-start mt-3">
                                            <i data-feather="mail" class="fea icon-ex-md text-muted me-3 mt-1"></i>
                                            <div class="flex-1">
                                                <h6 class="text-primary mb-0">Почта :</h6>
                                                <div class="bg-light p-2 rounded" style="max-height: 150px; overflow-y: auto;">
                                                    {% for email in item.email_list %}
                                                        <p class="text-muted mb-1">{{ email }}</p>
                                                    {% empty %}
                                                        <p class="text-muted mb-0">–</p>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>

                                    {% load custom_filters %}
                                        <div class="bg-light p-2 rounded" style="max-height: 150px; overflow-y: auto;">
                                            {% if item.phone %}
                                                <p class="text-muted mb-1">{{ item.phone }}</p>
                                            {% endif %}
                                           {% if item.phone2 %}
                                                <p class="text-muted mb-1">
                                                    {{ item.phone2|split_by_plus|join:" " }}
                                                </p>
                                            {% endif %}



                                            {% if item.phone_list %}
                                                {% for phone in item.phone_list %}
                                                    <p class="text-muted mb-1">{{ phone }}</p>
                                                {% endfor %}
                                            {% endif %}


                                            {% if not item.phone and not item.phone2 and not item.phone_list %}
                                                <p class="text-muted mb-0">–</p>
                                            {% endif %}
                                        </div>





                                        {% if item.result %}
                                        <div class="mt-4">
                                            <h6 class="text-primary mb-2">Детали результата:</h6>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-sm">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th>Ключ</th>
                                                            <th>Значение</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for key, value in item.result.items %}
                                                        <tr>
                                                            <td>{{ key }}</td>
                                                            <td>
                                                                {% if value is iterable and not value%}
                                                                    {{ value|join:", " }}
                                                                {% else %}
                                                                    {{ value }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Пагинация -->
<div class="row text-center">
    <div class="col-12 mt-4">
        <div class="d-md-flex align-items-center justify-content-between">
            <span class="text-muted me-3">
                Показано {{ page_obj.start_index }} – {{ page_obj.end_index }} из {{ page_obj.paginator.count }}
            </span>
            <ul class="pagination mb-0 justify-content-center mt-4 mt-sm-0">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">←</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">←</span></li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if num == page_obj.number %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">→</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">→</span></li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>

{% else %}
    <div class="alert alert-warning mt-4" role="alert">
        Нет данных для отображения.
    </div>
{% endif %}


                        <div class="row">
                            <div class="col-xl-6 col-12 mt-4">
                                <div class="card rounded shadow">
                                    <div class="p-3 border-bottom">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="mb-0 fw-bold">Искусственный интеллект</h6>
                                            
                                          
                                        </div>
                                    </div>

                                    <div class="table-responsive rounded-bottom" data-simplebar style="height: 270px;">
                                        <table class="table table-center bg-white mb-0">
                                            <thead>
                                                <tr>
                                                    <th class="p-3">Город</th>
                                                    <th class="text-center p-3">Сайт</th>
                                                    <th class="text-center p-3">Вероятность</th>
                                                    
                                                </tr>
                                            </thead>
                                            <tbody class="text-center">
                                                <!-- Start -->
                                                <tr>
                                                    <th class="text-start fw-semibold border-0 px-3 py-2"><span class="badge text-bg-success">Я еще обучаюсь</span></th>
                                                    <td class="small fw-semibold border-0 px-3 py-2">Скоро стану умнее</td>
                                                    <td class="small fw-semibold border-0 px-3 py-2">Спасибо!</td>
                                                    
                                                </tr>
                                                <!-- End -->

                                               
                                            </tbody>
                                        </table>
                                    </div>
                                </div><!--end -->
                            </div><!--end col-->

                          

<div class="col-xl-3 col-md-6 mt-4">
    <div class="card rounded shadow">
        <div class="p-3 border-bottom">
            <div class="d-flex justify-content-between">
                <h6 class="mb-0 fw-bold">Взял в работу</h6>
            </div>
        </div>
        <div class="p-3" data-simplebar style="height: 270px; overflow-y: auto;">
            {% for work in taken_work %}
            <div class="rounded shadow p-3 mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <span class="badge text-bg-success">Город</span>
                        <h6 class="fw-semibold mb-0 ms-2">{{ work.Sity }}</h6>
                    </div>
                </div>
                <div class="d-flex align-items-center mt-3">
                    <div class="">
                        <h6 class="text-muted mb-0">Сайт</h6>
                        <h6 class="mb-0">
                            <a href="{{ work.results }}" target="_blank">{{ work.results }}</a>
                        </h6>
                    </div>
                </div>
            </div>
            {% empty %}
            <p>Нет взятых в работу записей.</p>
            {% endfor %}
        </div>
    </div>
</div>



                        <div class="row text-center">
                            <!-- Отступ -->
                            <div class="col-12 mt-4">
                                <div class="d-md-flex align-items-center text-center justify-content-between">
                                   
                                </div>
                            </div><!--end col-->
                           <!-- Отступ -->
                        </div><!--end row-->
                <!-- Footer Start -->
                <footer class="shadow py-3">
                    <div class="container-fluid">
                        <div class="row align-items-center">
                            <div class="col">
                                <div class="text-sm-start text-center mx-md-2">
                                    <p class="mb-0 text-muted">© <script>document.write(new Date().getFullYear())</script> Landrick. Design with <i class="mdi mdi-heart text-danger"></i> by <a href="https://shreethemes.in/" target="_blank" class="text-reset">Shreethemes</a>.</p>
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->
                    </div><!--end container-->
           </footer><!--end footer-->
                <!-- End -->
            </main>
            <!--End page-content" -->
        </div>
        <!-- page-wrapper -->



     
        
        <!-- javascript -->
        <!-- JAVASCRIPT -->
       <script src="{% static 'main_app/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
		<script src="{% static 'main_app/libs/feather-icons/feather.min.js' %}"></script>
		<script src="{% static 'main_app/libs/simplebar/simplebar.min.js' %}"></script>

		<!-- Main Js -->
		<script src="{% static 'main_app/js/plugins.init.js' %}"></script>
		<script src="{% static 'main_app/js/app.js' %}"></script>
	

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('.take-item').click(function(e) {
        e.preventDefault();
        const btn = $(this);
        const itemId = btn.data('id');
        // Найдём ссылку и город из текущей строки
        const row = btn.closest('tr');
        const siteLink = row.find('td:nth-child(3) a').attr('href') || '';
        const city = row.find('td:nth-child(2) .ms-2').text().trim();

        $.ajax({
            url: "{% url 'take_in_work' %}",  // URL, куда отправлять запрос
            type: "POST",
            data: {
                'item_id': itemId,
                'site_link': siteLink,
                'city': city,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(response) {
                alert('Данные успешно записаны в работу');
                // Тут можно, например, отключить кнопку, или как-то обновить UI
                btn.prop('disabled', true).text('В работе');
            },
            error: function(xhr) {
                alert('Ошибка при записи данных');
            }
        });
    });
});
</script>




  <script>
// ДОБАВЬ ЭТУ ФУНКЦИЮ В НАЧАЛО
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ОСНОВНОЙ КОД
document.querySelectorAll('.take-item').forEach(function (button) {
    button.addEventListener('click', function (e) {
        e.preventDefault();
        const itemId = this.dataset.id;
        const csrftoken = getCookie('csrftoken');

        if (!itemId) {
            alert('Ошибка: не найден item_id');
            return;
        }

        console.log('Берём в работу ID:', itemId); // для отладки

        fetch('/take_item/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrftoken
            },
            body: new URLSearchParams({ item_id: itemId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'ok') {
                const container = document.querySelector('[data-simplebar]');

                const newBlock = document.createElement('div');
                newBlock.className = 'rounded shadow p-3 mb-3';
                newBlock.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <span class="badge text-bg-success">Город</span>
                            <h6 class="fw-semibold mb-0 ms-2">${data.city || '-'}</h6>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mt-3">
                        <div>
                            <h6 class="text-muted mb-0">Сайт</h6>
                            <h6 class="mb-0">
                                <a href="${data.link || '#'}" target="_blank">${data.link || 'ссылка'}</a>
                            </h6>
                        </div>
                    </div>
                `;

                container.prepend(newBlock);

                // Удаление строки из таблицы
                const row = document.getElementById('row-' + itemId);
                if (row) row.remove();
            } else {
                alert(data.message || 'Ошибка при взятии в работу');
            }
        })
        .catch(error => {
            alert('Ошибка запроса: ' + error.message);
            console.error(error);
        });
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    document.querySelectorAll('.btn-danger').forEach(function (button) {
        button.addEventListener('click', function (e) {
            e.preventDefault();
            const itemId = this.dataset.id;

            console.log('Удаляем id:', itemId);

            if (!itemId) {
                alert('Ошибка: не найден item_id');
                return;
            }

            if (!confirm('Удалить эту строку?')) return;

            fetch('/delete_item/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrftoken,
                },
                body: new URLSearchParams({ item_id: itemId })
            })
            .then(response => response.json())
            .then(data => {
                const row = document.getElementById('row-' + itemId);
                if (row) {
                    // Убираем строку со страницы в любом случае
                    row.remove();
                }

                if (data.status === 'ok') {
                    // Успешно удалено
                    console.log('Объект удалён');
                } else if (data.status === 'error') {
                    // Объект не найден, просто убираем строку без ошибки
                    console.warn(data.message);
                }
            })
            .catch(error => {
                alert('Ошибка запроса: ' + error.message);
                console.error(error);
            });
        });
    });
});
</script>




        
    </body>

</html>
{% endblock %}